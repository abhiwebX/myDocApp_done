<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello Doctor</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <style>
      .container {
        display: flex;

        flex-direction: column;
        margin-top: 0px;
        box-sizing: border-box;
        width: 900px;
        height: fit-content;
        border: 2px solid gray;
        padding-top: 5px;
        font-family: "Times New Roman", Times, serif;
      }

      h1 {
        text-align: center;
        font-family: "Times New Roman", Times, serif;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd">
      <div class="container-fluid">
        <a class="navbar-brand" href="home.html">Hello Doctor</a>
        <form class="d-flex">
          <a class="navbar-brand" href="" id="primarydata"></a>
          <button class="btn btn-outline-success" type="submit">
            <a href="../index.html" id="logpage">logOut</a>
          </button>
        </form>
      </div>
    </nav>
    <figure class="text-center">
      <blockquote class="blockquote" style="margin: 5px; font-size: x-large">
        <p>Keep Clam And Book Your Appointment Now</p>
      </blockquote>
    </figure>
    <h1>Book Appointment</h1>
    <div class="container">
      <form>
        <div class="row">
          <div class="col">
            <label for="">Enter Full Name :</label>
            <input
              type="text"
              class="form-control"
              id="pfname"
              placeholder="First name"
            />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="">Age</label>
            <input
              type="text"
              class="form-control"
              id="page"
              placeholder="Enter Age"
            />
          </div>
          <div class="col">
            <label for="">Gender</label>

            <input
              type="text"
              class="form-control"
              placeholder="Enter Gender"
              id="pgender"
            />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="">Email</label>
            <input
              type="email"
              class="form-control"
              placeholder="Enter Email "
              id="pemailis"
            />
          </div>
          <div class="col">
            <label for="">Contact Details</label>

            <input
              type="text"
              class="form-control"
              placeholder="Enter Contact"
              id="pnumber"
            />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="exampleFormControlSelect1">Date Selection</label>

            <input
              type="date"
              class="form-control"
              placeholder="select date"
              id="pdateselected"
            />
          </div>
          <div class="col">
            <label for="exampleFormControlSelect1">Time Selection</label>

            <input
              type="time"
              class="form-control"
              placeholder="Select Time"
              id="ptime"
            />
          </div>
        </div>

        <div class="col-auto my-1">
          <label class="mr-sm-2" for="inlineFormCustomSelect"
            >Select Disease</label
          >
          <select class="custom-select mr-sm-2" id="diseaseoption">
            <option selected>Choose Disease...</option>
            <option value="Corona_virus">Corona_virus</option>
            <option value="Dibeaties">Dibeaties</option>
            <option value="Bones issue">Bones issue</option>
          </select>
        </div>

        <div class="col-auto my-1">
          <label class="mr-sm-2" for="inlineFormCustomSelect"
            >Select Hospital</label
          >
          <select
            class="custom-select mr-sm-2"
            name="hospital"
            id="hospitalchoice"
          >
            <option selected>Choose Hospital...</option>
            <option value="lifeline_Hospital_Panvel">
              lifeline Hospital Panvel
            </option>
            <option value="Sparsh_Hospital_Panvel">
              Sparsh Hospital Panvel
            </option>
            <option value="jupiter_Hospital_Thane">
              jupiter Hospital Thane
            </option>
          </select>
        </div>

        <div class="col-auto my-1">
          <label class="mr-sm-2" for="inlineFormCustomSelect"
            >Select Doctor</label
          >
          <select class="custom-select mr-sm-2" id="doctoroption"></select>
        </div>
        <div
          class="my-3"
          style="
            display: flex;
            flex-direction: row;
            justify-content: space-between;
          "
        >
          <a href="./home.html" class="btn btn-warning" style="width: 80px"
            >Back</a
          >
          <button class="btn btn-warning" id="bookappimentdone">Submit</button>
        </div>
      </form>
    </div>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC9kkGh8iepJA52PMDLmpwVtcrEyh98rek",
        authDomain: "myapp2-bcd98.firebaseapp.com",
        databaseURL: "https://myapp2-bcd98-default-rtdb.firebaseio.com",
        projectId: "myapp2-bcd98",
        storageBucket: "myapp2-bcd98.appspot.com",
        messagingSenderId: "936569646334",
        appId: "1:936569646334:web:3907570ba67433369949af",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      var database = getDatabase();

      var doctors = {
        lifeline_Hospital_Panvel: [
          "Dr.AbhijeetDhekane ",
          "Dr.SanikaSnap",
          "Dr.OmkarGharat",
          "Dr.VijayRavat",
        ],
        Sparsh_Hospital_Panvel: [
          "Dr.NakulBhahurupi",
          "Dr.YashDhadve",
          "Dr.sujalpatil",
          "MohitSharma",
        ],
        jupiter_Hospital_Thane: [
          "Dr.PankajJaiswal",
          "Dr.RuturajGaikward",
          "Dr.SamrudiDube",
          "Dr.ShivamDube",
        ],
      };

      var main = document.getElementById("hospitalchoice");
      var sub = document.getElementById("doctoroption");
      main.addEventListener("change", function () {
        var selected_option = doctors[this.value];
        while (sub.options.length > 0) {
          sub.options.remove(0);
        }
        Array.from(selected_option).forEach(function (e) {
          let option = new Option(e, e);
          sub.appendChild(option);
        });
      });

      document
        .getElementById("bookappimentdone")
        .addEventListener("click", function (e) {
          e.preventDefault();
          var username = document.getElementById("pfname").value;
          localStorage.setItem("shortcut", username);
          var page = document.getElementById("page").value;
          var pgender = document.getElementById("pgender").value;
          var pcontact = document.getElementById("pnumber").value;
          var pdate = document.getElementById("pdateselected").value;
          var pemail = document.getElementById("pemailis").value;
          var ptime = document.getElementById("ptime").value;
          var x = document.getElementById("diseaseoption");
          var selected_disease = x.options[x.selectedIndex].text;
          var y = document.getElementById("hospitalchoice");
          var selected_hospital = y.options[y.selectedIndex].text;
          var z = document.getElementById("doctoroption");
          var selected_doc = z.options[z.selectedIndex].text;

          set(ref(database, "CurrentAppoiments/" + username), {
            username: username,
            email: pemail,
            Age: page,
            Gender: pgender,
            Contact: pcontact,
            Disease: selected_disease,
            hosptal: selected_hospital,
            doctor: selected_doc,
            Time: ptime,
            Date: pdate,
          });

          swal("Good job!", "You Appoiment is booked!", "success");

          document.getElementById("pdateselected").value = "";
          document.getElementById("ptime").value = "";

          x.selectedIndex = 0; // first option is selected, or
          y.selectedIndex = 0; // first option is selected, or
          z.selectedIndex = -1;
        });

      var username2 = localStorage.getItem("foriginekey");

      function show() {
        const dbref = ref(database);
        get(child(dbref, "profile/")).then((snapshot) => {
          let darray = [];
          snapshot.forEach((childSnapshot) => {
            darray.push(childSnapshot.val());
          });
          gooo(darray);
        });
      }
      show();

      function gooo(darray) {
        darray.map((e, i) => {
          if (e.username == username2) {
            document.getElementById("pfname").value = e.username;
            document.getElementById("page").value = e.Age;
            document.getElementById("pgender").value = e.Gender;
            document.getElementById("pnumber").value = e.Contact;
            document.getElementById("pemailis").value = e.email;
          }
        });
      }

      document
        .getElementById("logpage")
        .addEventListener("click", function (e) {
          localStorage.removeItem("primaryKey");
          localStorage.removeItem("foriginekey");
        });
    </script>
  </body>
</html>
